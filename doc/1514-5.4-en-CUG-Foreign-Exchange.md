# Foreign Exchange
**Customization Upgrade Guide**  
**Release 5.4**  
**Area**: FX & Money Market  

*Confidential*  
[www.avaloq.com](https://www.avaloq.com) | documentation@avaloq.com  
© 2022 Avaloq Evolution Ltd. All rights reserved.

---

## Latest Version
The latest version of this document can be found at:  
[https://docs.avaloq.com](https://docs.avaloq.com)

## Feedback
Please send any feedback to: documentation@avaloq.com

---

## Copyright Notice

The information in this document is provided for informational purposes only, is subject to change without notice, and is not warranted to be error-free.  
No part of this document may be used, reproduced, or transmitted in any form or by any means unless authorized by Avaloq Evolution Ltd through a written licence agreement.  
Further, this document does not grant any rights to, or in, the products mentioned therein and no rights of any kind relating to such products will be granted except pursuant to written agreements with Avaloq Evolution Ltd.

Avaloq Evolution Ltd.  
Allmendstr. 140  
CH-8027 Zürich, Switzerland  

---

## Version History

While the document ID of a Customization Upgrade Guide remains the same, the content is different in every release.  
This is because the document describes the customization adaptations required between two specific releases.  
To preserve your existing customization, read the entire document and make the necessary adaptations before you upgrade your system.

| Version / Date    | Section | Description of the Change |
|-------------------|---------|----------------------------|
| 5.4v0 / 20 Apr 2022 |         | This is a new document.     |

---

## Contents

1. Introduction  
2. Upgrade Steps  
    2.1 Base Parameter Item: `map_maturity_to_val_date`  
    2.2 Switching `map_maturity_to_val_date` from "+" to "-" (optional)

---

## 1. Introduction

This document describes the changes necessary to keep the existing functionality of components in the FX & Money Market area after an upgrade of the system to Release 5.4.

This document is intended for customization specialists.

---

## 2. Upgrade Steps

### 2.1 Base Parameter Item: `map_maturity_to_val_date`

In Release 5.4, the default value of the `map_maturity_to_val_date` item of the `avq.doc.fxtr` base parameter has changed from `"+"` to `"-"`.  
This aligns with the desired behaviour for new clients.  

If you haven't explicitly set this parameter in your customization and relied on the default value, you must now **explicitly set** it to `"+"` to keep current behaviour — mapping the maturity date to `doc.val_date` in the FXTR business type.

If you already have it set to `"-"`, this change does not affect you.

If you're switching from `"+"` to `"-"`:
- Ensure `doc_fxtr.maturity_date` is used instead of `doc.val_date` in customization.
- Perform mandatory **data migration** of existing FX forward orders.

> See Section 2.2 below for details on switching from `"+"` to `"-"`.

---

### 2.2 Switching `map_maturity_to_val_date` from "+" to "-" (optional)

This is only relevant if you previously used `"+"` and now want to use `"-"`.

#### Field Mapping Comparison (Example: Opening Order FX Forward on 07.07.2021 with Maturity 09.08.2021):

| Field                 | Base par item = "+" | Base par item = "-" |
|----------------------|---------------------|----------------------|
| `doc_fxtr.trx_date`  | 07.07.2021          | 07.07.2021           |
| `doc_fxtr.spot_date` | 09.07.2021          | 09.07.2021           |
| `doc_fxtr.val_date`  | 09.08.2021          | 07.07.2021           |
| `doc_fxtr.maturity_date` | 09.08.2021 or NULL | 09.08.2021        |

---

#### Migration Process

1. **Read the Current Last Pillar Date**

```sql
SELECT last_pillar FROM base WHERE bu_id = :bu_id;
