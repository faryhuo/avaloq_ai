# Stock Exchange  

**Customization Upgrade Guide**  
Release 5.7  
Area: Securities Trading  

**Confidential**  
© 2023 Avalog Group Ltd. All rights reserved.  

---

## Latest version of this document  
Available at:  
[https://docs.avalog.com](https://docs.avalog.com)  

## Feedback  
Contact: [documentation@avalog.com](mailto:documentation@avalog.com)  

**Copyright Notice:**  
> The information in this document is confidential, subject to change, and not guaranteed error-free. Unauthorized use or reproduction is prohibited.  
>  
> **Avalog Group Ltd.**  
> Allmendstr. 140 | CH-8027 Zürich | Switzerland  

---

## Version history  

| Version / Date       | Section | Description of the change        |  
|----------------------|---------|----------------------------------|  
| 5.7v0 / 22 Sep 2023 |         | Initial release for Avaloq 5.7.  |  

---

## Contents  

### 1 Introduction  
1.1 **Deactivate duplicate quantity entry in `CODE_DOC_REVS_CAUSE`** ...... 5  
1.2 **FIX Doc New Single IN: PreAllocGrp logic** ...... 6  
1.3 **FIX Allocation Instruction: Tag 79 AllocAccount** ...... 7  

---

### 1 Introduction  
This guide outlines customization changes for Avaloq Core 5.7 related to **securities trading** fixes.  

#### 1.1 Deactivate duplicate quantity entry in `CODE_DOC_REVS_CAUSE`  
**Issue:**  
- Two identical entries (`ID=7` and `ID=8`) for "Wrong quantity" in `CODE_DOC_REVS_CAUSE` caused user confusion.  

**Fix in 5.7:**  
- Entry `ID=8` is deactivated by default (`Activ=null`). Users now see only `ID=7`.  

**Customization Impact:**  
- **No action needed** if previously using both entries.  
- **Manual activation required** if relying on `ID=8` (set `Activ=true`).  
- **DDIC Access:** Directly reference `code_doc_revs_cause.quantity` (no lookups needed).  

**Recommendation:**  
- Audit existing code for references to `ID=7` or `ID=8` using `g-search` in ICE.  

---

#### 1.2 FIX Doc New Single IN: PreAllocGrp Logic  
**Behavior Changes:**  

| **PreAllocGrp Presence** | **Action Triggered** |  
|--------------------------|----------------------|  
| **Present** | • Market order created.  <br> • Message status: *Wait for Processing*.  <br> • Async allocation via `TASK_STEX_PRC_ALLOC_INFO`. |  
| **Absent**  | Default client order created. Custom logic via `fix_doc_new_single_in_css.msg#action`. |  

**Custom Overrides:**  
```sql
-- Return values for custom logic:
-- Null: Kernel default
-- code_stex_intf_msg_action.new_clt_doc: Client order
-- code_stex_intf_msg_action.new_mkt_doc_id: Market order