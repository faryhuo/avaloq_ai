# Avaloq Script

**Customization Upgrade Guide**
Release 5.7

Area: Technical Base

---
**Latest version of this document**

The latest version of this document can be found at https://docs.avaloq.com

**Feedback**

Please send any feedback to documentation@avaloq.com

Copyright Avaloq Group Ltd. All rights reserved.
The information in this document is provided for informational purposes only, is subject to change without notice and is not warranted to be error-free. [cite: 3] No part of this document may be used, reproduced or transmitted in any form or by any means unless authorized by Avaloq Group Ltd through a written licence agreement. [cite: 4] Further, this document does not grant any rights to, or in, the products mentioned therein and no rights of any kind relating to such products will be granted except pursuant to written agreements with Avaloq Group Ltd. [cite: 5]
Avaloq Group Ltd. Allmendstr. 140 CH-8027 ZÃ¼rich | Switzerland [cite: 6]

---
## Version history

| Version / Date     | Section | Description of the change |
| ------------------ | ------- | ------------------------- |
| 5.7v0/7 June 2023 |         | New document for ACP 5.7  |

---
## Contents

* 1 Introduction [cite: 10]
    * 1.1 Results of this change [cite: 10]

---
## 1 Introduction

This document describes changes that you may need to make to your customization when you upgrade to Avaloq Core Release 5.7, as a result of enhancements to Avaloq Script in that release. [cite: 12]
Previously in Avaloq Script, the "id table type" data type was always translated to the PL/SQL data type as follows (see section 5.6 of Avaloq Script Language Reference - Reference Guide (doc ID: 1074)): [cite: 13]

* varchar2(2000) - for variables and constants [cite: 13]
* varchar2 - for parameters [cite: 13]

Starting in Avaloq Core Release 5.7, the Avaloq Script "id table type" will be translated to something more specific for tables that have a primary key that consists of one column whose type is numeric. [cite: 13]
In Avaloq Core Release 5.7, an "id table type" in Avaloq Script of any code table, or of the tables MSG, DOC, or OBJ are translated as follows. [cite: 14]

| This Avaloq Script data type | Is translated to this PL/SQL data type |
| ---------------------------- | ------------------------------------ |
| id table code table          | pls_integer                          |
| id table msg                 | number(12)                           |
| id table doc                 | number(12)                           |
| id table obj                 | pls_integer                          |
[cite: 15]
### 1.1 Results of this change

As a result of this change, some code modifications may be necessary during the release upgrade. [cite: 16]

**Passing text to an id table with a number type**

Any context where these types are expected (assignments, function calls, comparisons, function returns) cannot contain a text value. [cite: 17] This would lead to a runtime exception, unless the text value can be converted to a number. [cite: 18] Where possible without changing behaviour, the compiler will prevent runtime exceptions. [cite: 19] Where it is not possible, a warning is provided by ASMD and the Compiler Framework to indicate where runtime exceptions might occur. [cite: 20] In these cases, action may need to be taken by adapting customization code (note that often these warnings will highlight existing business logic or programming mistakes). [cite: 21] Because these types are now numeric types, they are treated like a number, including in comparisons. [cite: 22]

**Action to be taken:** [cite: 23]

* Analyse occurrences of the "Potential runtime type conversion error" warning during release upgrade. [cite: 23]
    * If the text value is known to contain a number (for example, a value from a textual API or from a list stored in lib_co), no action is needed and the warning can be ignored. [cite: 23]
    * If the text value could actually be text, the custom code should be adapted (for example, change the type of the containing variable, or change the value to an appropriate numeric value). [cite: 23]

**Passing id table types of different types to each other**

An id type of MEM_DOC, MEM_MSG or OBJ might not be able to hold an id type of DOC or MSG, because the PL/SQL types for MEM_DOC, MEM_MSG or OBJ have a smaller range than the ones for DOC and MSG. [cite: 25] So a compile-time error might also arise if the types are misused, that is, if a type with a smaller range is assigned from a type with a larger range (for example, assigning a DOC to a MEM_DOC). [cite: 26] The compiler will issue a warning for any other assignment between an id type of a memory DDIC and a table DDIC, or any assignment of id types with different PL/SQL types. [cite: 27]

*Image description: The image displays a code editor window showing PL/SQL code with several lines highlighted with error or warning indicators. Below the code, a panel lists "SCRIPT PACKAGE-Type check expressions (2 items)" and "SCRIPT PACKAGE-Type check expressions de-release warning on DDIC Types (10 items)". Each item in the list details an incompatibility issue, such as "Incompatible types expected type 'id mem msg' but found type 'id doc'" or "Incompatible ddic types: expected type 'id doc' but found type 'id mem msg, one is a table DDIC and the other one is a memory DDIC", along with the line number and source name.* [cite: 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38]

**Action to be taken:**

Often, assigning different DDIC types to each other is a programming or logic error that you should fix. [cite: 39] If it's not, add a type cast. [cite: 39]